<div class="content-section">
    <p-toast position="top-right"></p-toast>
    <div class="">
        <p-table [value]="sectors" styleClass="annex p-datatable-gridlines" dataKey="name" editMode="row">
            <ng-template pTemplate="header">
                <tr>
                    <th colspan="16">
                        <span style="position: absolute;left: 0;right: 0;">Table 1 : Advances and NPAs (Gross) - Sector wise position</span>
                        <span class="float-right">Amount in Crores</span>
                    </th>
                </tr>
                <tr>
                    <th rowspan="2" class="text-center">Sector</th>
                    <th colspan="3">FY {{currentFY-1}}- {{currentFY}}</th>
                    <th *ngFor="let qt of quarters" colspan="3">{{qt}}</th>
                </tr>
                <tr class="text-sm">
                    <ng-container *ngFor="let i of arrayOf(5)">
                        <th>O/s Balance</th>
                        <th>Gross NPA</th>
                        <th>% NPA</th>
                    </ng-container>
                </tr>

            </ng-template>
            <ng-template pTemplate="body" let-sector let-editing="editing" let-ri="rowIndex">
                <tr [pEditableRow]="sector">
                    <td class="text-red text-left text-bold text-1em bg-white">{{sector.title}}</td>
                    <ng-container *ngFor="let i of arrayOf(5);let index=index">
                        <ng-container *ngIf="index==0">
                            <td>{{findData(sector.name,index,'osBalance')|number : '1.2-2'}}</td>
                            <td>{{findData(sector.name,index,'grossNPA')|number : '1.2-2'}}</td>
                            <td>{{findData(sector.name,index,'percentileNPA')|number : '1.2-2'}}</td>
                        </ng-container>
                        <ng-container *ngIf="index>0"> 
                            <ng-container *ngIf="isEditable(data[sector.name],index)">
                                <td pEditableColumn>
                                    <p-cellEditor>
                                        <ng-template pTemplate="input">
                                            <input pInputText type="number" [(ngModel)]="data[sector.name]['Q'+index]['osBalance']">
                                        </ng-template>
                                        <ng-template pTemplate="output">
                                            {{data[sector.name]['Q'+index]['osBalance']}}
                                        </ng-template>
                                    </p-cellEditor>
                                </td>
                                <td pEditableColumn>
                                    <p-cellEditor>
                                        <ng-template pTemplate="input">
                                            <input pInputText type="number" [(ngModel)]="data[sector.name]['Q'+index]['grossNPA']">
                                        </ng-template>
                                        <ng-template pTemplate="output">
                                            {{data[sector.name]['Q'+index]['grossNPA']}}
                                        </ng-template>
                                    </p-cellEditor>
                                </td>
                                <td>
                                    <p-cellEditor>
                                        <ng-template pTemplate="input">
                                            <input pInputText type="number" [(ngModel)]="data[sector.name]['Q'+index]['percentileNPA']">
                                        </ng-template>
                                        <ng-template pTemplate="output">
                                            {{findPercentile(data[sector.name]['Q'+index]['osBalance']|number : '1.2-2' , data[sector.name]['Q'+index]['grossNPA']|number : '1.2-2', sector.name, index)}}
                                        </ng-template>
                                    </p-cellEditor>
                                </td>
                            </ng-container>
                            <ng-container *ngIf="!isEditable(data[sector.name],index)">
                                <td>{{data[sector.name]['Q'+index]['osBalance']|number : '1.2-2'}}</td>
                                <td>{{data[sector.name]['Q'+index]['grossNPA']|number : '1.2-2'}}</td>
                                <td>{{findPercentile(data[sector.name]['Q'+index]['osBalance']|number : '1.2-2', data[sector.name]['Q'+index]['grossNPA']|number : '1.2-2', sector.name, index)}}</td>
                            </ng-container>
                        </ng-container>
                    </ng-container>
                </tr>
                <!-- </tbody> -->
            </ng-template>
            <ng-template pTemplate="footer">
                <tr>
                    <td><b>Total</b></td>
                    <ng-container *ngFor="let i of arrayOf(5);let index=index">
                        <td class="sum">{{findSum(index,'osBalance')}}</td>
                        <td class="sum">{{findSum(index,'grossNPA')}}</td>
                        <td class="sum">{{findPercentileSum(findSum(index,'grossNPA'),findSum(index,'osBalance'))}}</td>
                    </ng-container>
                </tr>
            </ng-template>
        </p-table>
        <div class="text-center mt-2 mb-2 pt-2">
            <button pButton icon="pi pi-check" (click)="saveAnnex()" label="Save" class="p-button-primary mr-2"></button>
            <button pButton type="button" (click)="postAnnex()" icon="pi pi-upload" label="Submit" class=" ml-2 p-button-success"></button>
        </div>
    </div>
</div>

<p-confirmDialog header="Confirmation" icon="pi pi-exclamation-triangle"></p-confirmDialog>

