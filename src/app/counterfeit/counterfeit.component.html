<p-toast position="top-right">
</p-toast>
<div class="p-grid"></div>
<div class="p-col">
    <h3 style="text-align: center; padding-top: 12px;"  class="m-0 pt-1" >{{heading}}</h3>
</div>
<div class="card">
    <p-tabView>
   
        <div class="p-grid" style="text-align:inital;">
            <div class="p-col">
                <input type="text" pInputText placeholder="Branch Ref No" [(ngModel)]="branchRefNo" name="branchRefNo" style="width:200px">
                <button type="button" pButton pRipple label="Search" (click)="getSubmitted()"></button>
            </div>
           
              
            <div class="p-col text-right add" style="padding-bottom: 17px;" >
                <button  pButton type="button" icon="pi pi-plus" iconPos="right" class="mr-2 " label="Add" (click)="add()"></button>
            </div>
        </div>
        <div class="stress ease">
            
            <form style="text-align: left;" #accountForm="ngForm">
                <div class="scroller">
                <p-table  [value]="display" dataKey="name" editMode="row" class="tableFixed">
                    <ng-template pTemplate="header">
                        
                        
                        <tr >
                            <ng-container>
                                <!-- <th>S. No.</th> -->
                                <th *ngFor="let hr of tableNames">
                                    {{hr.name}}
                                    <!-- <span *ngIf="hr.required" style="color: yellow;">*</span> -->
                                    <br>{{hr.subText}}

                                </th>
                                 <!-- <th style="max-width: 100px;min-width: 50px;"> 
                                     Action
                                  </th>     -->
                            </ng-container>
                        </tr>
                    </ng-template>
                    <ng-template pTemplate="body" let-account let-ri="rowIndex">
                        <tr [pEditableRow]="account">
                             <ng-container *ngIf="account.edit==true || account.newRecord==true"> 
                                <td pEditableColumn *ngFor="let name of tableNames" [ngClass]="{'disabled':(!name.editable )}" >
                                    <ng-container *ngIf="!name.editable  ">
                                        {{account[name.title]}}
                                    </ng-container>
                                    <ng-container>
                                        {{name.edit}}
                                    </ng-container>
                                    <p-cellEditor *ngIf="name.editable ">
                                        <ng-template pTemplate="input">
                                            <input pInputText [required]="name.required" [name]="name.title" [type]="name.inpType" [(ngModel)]="account[name.title]" [min]="1" maxlength="7" *ngIf="name.title!='faxNo' && name.title!='branchId' && name.title!='detectionDate' && name.title!='tenderingDate' && name.title!='branchName'&&  name.title!='address' && name.title!='branchCode' && name.title!='city' && name.title!='stateCode' && name.title!='pin' && name.title!='countryCode' && name.title!='telephoneNo' && name.title!='mobileNo' && name.title!='informedPolice' && name.title!='policeReportDetails' && name.title!='tenderingPerson' && name.title!='accountHolder' && name.title!='accountNumber' && name.title!='currencySerialNo' && name.title!='detectedAt' && name.title!='priority'  && name.title!='branchEmail' && name.title!='action' ">
                                            <input pInputText [required]="name.required" [name]="name.title" [type]="name.inpType" [(ngModel)]="account[name.title]" (change)="changed=true;getBranchDetails($event,account,name)" *ngIf="name.title=='branchId'">
                                            <input pInputText [required]="name.required" [name]="name.title" [type]="name.inpType" [(ngModel)]="account[name.title]" *ngIf="name.title=='faxNo'"  maxlength="50">
                                            <input pInputText [required]="name.required" [name]="name.title" [type]="name.inpType" [(ngModel)]="account[name.title]" *ngIf="name.title=='branchCode'" minlength="1" maxlength="7" >
                                            <input pInputText [required]="name.required" [name]="name.title" [type]="name.inpType" [(ngModel)]="account[name.title]" *ngIf="name.title=='branchName'" minlength="1" maxlength="200" >
                                            <input pInputText [required]="name.required" [name]="name.title" [type]="name.inpType" [(ngModel)]="account[name.title]" *ngIf="name.title=='detectionDate'" >
                                            <input pInputText [required]="name.required" [name]="name.title" [type]="name.inpType" [(ngModel)]="account[name.title]" *ngIf="name.title=='tenderingDate'" >
                                            <input pInputText [required]="name.required" [name]="name.title" [type]="name.inpType" [(ngModel)]="account[name.title]" *ngIf="name.title=='telephoneNo'"   maxlength="50">
                                            <input pInputText [required]="name.required" [name]="name.title" [type]="name.inpType" [(ngModel)]="account[name.title]" *ngIf="name.title=='address'" minlength="15" maxlength="500" >
                                            <input pInputText [required]="name.required" [name]="name.title" [type]="name.inpType" [(ngModel)]="account[name.title]" *ngIf="name.title=='mobileNo'" minlength="10" maxlength="30" >
                                            <input pInputText [required]="name.required" [name]="name.title" [type]="name.inpType" [(ngModel)]="account[name.title]" *ngIf="name.title=='city'" minlength="1"  maxlength="100">
                                            <input pInputText [required]="name.required" [name]="name.title" [type]="name.inpType" [(ngModel)]="account[name.title]" *ngIf="name.title=='stateCode'" maxlength="15" >
                                            <input pInputText [required]="name.required" [name]="name.title" [type]="name.inpType" [(ngModel)]="account[name.title]" *ngIf="name.title=='pin'" minlength="1" maxlength="20" >
                                            <input pInputText [required]="name.required" [name]="name.title" [type]="name.inpType" [(ngModel)]="account[name.title]" *ngIf="name.title=='countryCode'"  maxlength="50" >
                                            <input pInputText [required]="name.required" [name]="name.title" [type]="name.inpType" [(ngModel)]="account[name.title]" *ngIf="name.title=='branchEmail'" minlength="1" maxlength="50" >
                                            <input pInputText [required]="name.required" [name]="name.title" [type]="name.inpType" [(ngModel)]="account[name.title]" *ngIf="name.title=='currencySerialNo'" minlength="1" maxlength="50" >
                                            <!-- <input pInputText [required]="name.required" [name]="name.title" [type]="name.inpType" [(ngModel)]="account[name.title]" *ngIf="name.title=='detectedAt'" minlength="1" maxlength="500" > -->
                                            <!-- <input pInputText [required]="name.required" [name]="name.title" [type]="name.inpType" [(ngModel)]="account[name.title]" *ngIf="name.title=='informedPolice'" minlength="1" maxlength="5" > -->
                                            <input pInputText [required]="name.required" [name]="name.title" [type]="name.inpType" [(ngModel)]="account[name.title]" *ngIf="name.title=='policeReportDetails'" minlength="1" maxlength="500" >
                                            <input pInputText [required]="name.required" [name]="name.title" [type]="name.inpType" [(ngModel)]="account[name.title]" *ngIf="name.title=='tenderingPerson'" minlength="1" maxlength="100" >
                                            <input pInputText [required]="name.required" [name]="name.title" [type]="name.inpType" [(ngModel)]="account[name.title]" *ngIf="name.title=='accountHolder'" minlength="1" maxlength="100" >
                                            <input pInputText [required]="name.required" [name]="name.title" [type]="name.inpType" [(ngModel)]="account[name.title]" (change)="changed=true;getAccountName($event,account,name)" *ngIf="name.title=='accountNumber'" minlength="1" maxlength="100" >
                                            <select class="p-dropdown-label p-inputtext ng-star-inserted selectLabel" [name]="name.title" [(ngModel)]="account[name.title]" *ngIf="name.title=='detectedAt'" >
                                                    <option value="B-Branch ">Branch </option>
                                                    <option value="C-Currency Chest">Currency Chest</option>
                                            </select>
                                            <select class="p-dropdown-label p-inputtext ng-star-inserted selectLabel" [name]="name.title" [(ngModel)]="account[name.title]" *ngIf="name.title=='priority'"  >
                                                <option value="P1-VERY HIGH">P1-Very high</option>
                                                <option value="P2-HIGH">P2-High</option>
                                                <option value="P3-NORMAL">P3-Normal</option>
                                            </select>

                                            <select class="p-dropdown-label p-inputtext ng-star-inserted selectLabel" [name]="name.title" [(ngModel)]="account[name.title]" *ngIf="name.title=='informedPolice'" >
                                                <option value="yes">YES</option>
                                                <option value="no">NO</option>
                                            </select>
                                            
                                        </ng-template>
                                        <ng-template pTemplate="output">
                                            {{name.title=="tenderingDate" || name.title=="detectionDate"?(account[name.title] | date : 'dd-MM-yyyy'):account[name.title]}}
                                        </ng-template>
                                    </p-cellEditor>
                                    <ng-container>
                                        <div class="p-field p-col m-0" *ngIf="name.title=='action' && submitted==false">

                                            <i class="pi pi-trash text-danger" (click)="!submitted && delete(ri)"></i>
                                        </div>     
                                        <div class="p-field p-col m-0" *ngIf="name.title=='action' && account.edit==true">
                                            <td>
                                                <button pButton pRipple type="button" (click)="editUnClicked(account)" icon="pi pi-times-circle" class="p-button-rounded p-button-text" text-align="center"></button>
                                            </td>
                                        </div>                                        
                                        </ng-container>
                                </td>
                          
                        </ng-container>    
                        </tr>
                        <tr>
                            <ng-container *ngIf="account.edit==false && account.newRecord==null" >
                               
                                <td pEditableColumn *ngFor="let name of tableNames"  [ngClass]="{'disabled':(!account.edit)}" [ngStyle] = "{'background-color': account.edit==false  ? '#dee2e6' :'#fff' }">
                                    <ng-container>
                                        {{name.title=="detectionDate" || name.title=="tenderingDate"|| name.title=="createdDate"?(account[name.title] | date : 'dd-MM-yyyy'):account[name.title]}}
                                    </ng-container>
                                    <!-- <div class="p-field p-col m-0" *ngIf="name.title=='action'">
    
                                            <button pButton pRipple type="button" (click)="editClicked(account)" icon="pi pi-pencil" class="p-button-rounded p-button-text" text-align="center"></button>
                                
                                    </div> -->
                                </td>     
                            </ng-container>
                        </tr>
                    </ng-template>
                </p-table>
                </div>
            </form>
            
        </div>
        
    </p-tabView>
</div>
<!-- <div>
    <textarea [disabled]="!isChecker || submittedRecords!='SUBMITTED'" [(ngModel)]="comments" class="comment" placeholder="Comment here..."></textarea>
</div> -->
<!-- <div *ngIf="isChecker">
    <textarea class="comments" placeholder="Comment Here..."></textarea>
</div> -->

<div  style="margin-top: 1%;text-align: center;">

    <button pButton icon="pi" label="Submit" (click)="submit()"    style="border: none;background: #a20a3a;color: white;" class="p-button-primary mr-2"></button>
</div>
<!-- <div  *ngIf="isChecker" class="text-center mt-2 mb-2 pt-2">
    <button pButton icon="pi-pi-times" (click)="confirm('REJECTED')" label="Reject"
        class="p-button-primary mr-2"></button>
    <button pButton type="button"  (click)="confirm('APPROVED')" label="Approve"
        class=" ml-2 p-button-success"></button>
</div> -->


<p-confirmDialog header="Confirmation" icon="pi pi-exclamation-triangle"></p-confirmDialog>