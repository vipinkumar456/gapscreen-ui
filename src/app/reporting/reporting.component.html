
<p-toast position="top-right">
</p-toast>

<div class="p-col">
    <h3 style="text-align: center; padding-top: 12px;" class="m-0 pt-1">{{heading}}</h3>
</div>
<div class="card">

    <p-tabView>
    <div class="p-grid" style="text-align:inital;">

        <div class="p-inputgroup ">
            <!-- <button type="button" pButton pRipple label="Search"></button> -->
        </div>

        <div class="p-col text-right add" style="padding-bottom: 17px;" *ngIf="isMaker">
            <button pButton type="button" icon="pi pi-plus" iconPos="right" class="mr-2 " label="Add"
                (click)="add()"></button>
            <p-button label="Rejected Records" iconPos="left" styleClass="p-button p-button-pnb btn-block"
                (click)="rejectedRecords()"></p-button>
        </div>
    </div>

    <div class="stress ease">

        <form style="text-align: left;" #accountForm="ngForm">
            <div class="scroller">
                <p-table [value]="display" dataKey="name" editMode="row" class="tableFixed">
                    <ng-template pTemplate="header">
                        <tr>
                            <ng-container>
                                <th style="min-width:50px;" *ngIf="isChecker || rejectedFlag">
                                    <input type="checkbox" name="checkedAll" [(ngModel)]="checkedAll"
                                        (change)="checkAll()">
                                </th>
                                <th *ngFor="let hr of tableNames">
                                    {{hr.name}}
                                    <br>{{hr.subText}}
                                </th>
                                <th *ngIf="!isChecker && !rejectedFlag">Action</th>
                            </ng-container>
                        </tr>
                    </ng-template>
                    <ng-template pTemplate="body" let-account let-ri="rowIndex">
                        <tr [pEditableRow]="account">
                            <ng-container>
                                <td *ngIf="isChecker || rejectedFlag"><input type="checkbox" name="checked{{ri}}"
                                        [(ngModel)]="account.checked" (change)="checkRecord(account)"></td>
                                <td pEditableColumn *ngFor="let name of tableNames"
                                    [ngClass]="{'disabled':(!name.editable || submitted || isChecker)}">
                                    <ng-container *ngIf="!name.editable || submitted || isChecker">
                                        <!-- {{account[name.title]}} -->
                                        {{name.title=="createdOn" || name.title=="date"?(account[name.title] |
                                            date : 'dd-MM-yyyy'):account[name.title]}}
                                    </ng-container>
                                    <ng-container>
                                        {{name.edit}}
                                    </ng-container>
                                    <p-cellEditor *ngIf="(name.editable && !submitted) && !isChecker">
                                        <ng-template pTemplate="input">
                                            <input pInputText [required]="name.required" [name]="name.title" (change)="getTotalExposure(account)"
                                                [type]="name.inpType" [(ngModel)]="account[name.title]" [min]="1"  (keypress)="numberOnlyWithDismal($event)" step="0.01" *ngIf="name.title=='date' || name.title=='tradeExposure' || name.title=='defaultFundExposure' || name.title=='others' || name.title=='totalExposure' || name.title=='totalExposureRatio'">
                                            <select class="p-dropdown-label p-inputtext ng-star-inserted selectLabel"
                                                [name]="name.title" [(ngModel)]="account[name.title]"
                                                *ngIf="name.title=='nameOfQccp'">
                                                <option value="CCIL"> CCIL</option>
                                                <option value="NSCCL">NSCCL</option>
                                                <option value="MCX-SXCCL">MCX-SXCCL</option>
                                                <option value="ICCL">ICCL</option>
                                            </select>
                                        </ng-template>
                                        <ng-template pTemplate="output">
                                            {{name.title=="tenderingDate" || name.title=="date"?(account[name.title] |
                                            date : 'dd-MM-yyyy'):account[name.title]}}
                                        </ng-template>
                                    </p-cellEditor>
                                </td>
                                <td *ngIf="!isChecker && !rejectedFlag">
                                    <i class="pi pi-trash text-danger" (click)="delete(ri)"></i>
                                </td>

            </ng-container>
            </tr>
            <!-- <tr>
                <ng-container *ngIf="account.edit==false && account.newRecord==null">

                    <td pEditableColumn *ngFor="let name of tableNames" [ngClass]="{'disabled':(!account.edit)}"
                        [ngStyle]="{'background-color': account.edit==false  ? '#dee2e6' :'#fff' }">
                        <ng-container>
                            {{name.title=="detectionDate" || name.title=="tenderingDate"||
                            name.title=="createdOn"?(account[name.title] | date : 'dd-MM-yyyy'):account[name.title]}}
                        </ng-container>
                    </td>
                </ng-container>
            </tr> -->
            </ng-template>
            </p-table>
    </div>
    </form>

</div>
</p-tabView>

</div>

<div *ngIf="isChecker">
    <textarea [disabled]="submitted==true" class="comments" [(ngModel)]="comments"
        placeholder="Comment Here..."></textarea>
</div>

<div *ngIf="isMaker" style="margin-top: 1%;text-align: center;">

    <button pButton icon="pi" label="Submit" (click)="submit('SUBMITTED')" [disabled]="submitted==true"
        style="border: none;background: #a20a3a;color: white;" class="p-button-primary mr-2"></button>
</div>
<div *ngIf="isChecker" class="text-center mt-2 mb-2 pt-2">
    <button [disabled]="submitted==true" pButton icon="pi-pi-times" (click)="confirm('REJECTED')" label="Reject"
        class="p-button-primary mr-2"></button>
    <button [disabled]="submitted==true" pButton type="button" (click)="confirm('APPROVED')" label="Approve"
        class=" ml-2 p-button-success"></button>
</div>


<p-confirmDialog header="Confirmation" icon="pi pi-exclamation-triangle"></p-confirmDialog>
