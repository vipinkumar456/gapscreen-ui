<p-toast position="top-right">
</p-toast>
<div  class="mt-2 mb-2 pt-2 text-center">
    <div *ngIf="errorMessage">{{errorMessage}}</div>
    <form [formGroup]="newForm">
        <ul class="search-form">
            <li>
                <p-dropdown formControlName="report" (onChange)="getRoleByReport($event)" [options]="dropdown.report"  placeholder="Select Report Name*"></p-dropdown>
            </li>
            <li>
                <p-dropdown formControlName="years" [options]="dropdown.years" placeholder="Select financial year*">
                </p-dropdown>
            </li>
            <li>
                <p-dropdown formControlName="quarters" [options]="quarters" placeholder="Select a Quarter*"></p-dropdown>
            </li>
            <li>
                <p-button label="Search" icon="pi pi-search" iconPos="left" styleClass="p-button p-button-pnb btn-block"
            (click)="submitForm()"></p-button>
            </li>
        </ul>
    </form>
</div>
<div *ngIf="table">
    
    <div class="p-col-12 text-right">
        <button [disabled]="isChecker || reportStatus=='SUBMITTED' ||  reportStatus=='APPROVED'" pButton type="button" icon="pi pi-download" iconPos="left" class="mr-2 " (click)="download()"
            label="Download Template"></button>
        <button [disabled]="isChecker || reportStatus=='SUBMITTED' ||  reportStatus=='APPROVED'" pButton type="button" icon="pi pi-upload" iconPos="left" class="p-button-danger ml-2" (click)="upload()"
            label="Upload"></button>
    </div>
    <div class="tableHeading">


        <span style="position: absolute;left: 0;right: 0; text-align: left; padding: 15px;height: 20px;">{{pageHeading}}</span>
        <span style="padding: 15px;" class="float-right">Amount in Crores</span>



        <input type="file" #fileInput style="width: 100%;visibility: hidden; height: 0px;" accept=".xlsx,.xls"
            (change)="uploadFile()" multiple="false" />
        <!-- <table>
            <tr>
                <th>S.no</th>
                <th>Borrower Name</th>
                <th>Segment
                    (Infra, NBFC, SME, Retail, Telcom, etc.)</th>
                <th>Exposure</th>
                <th>OutStanding
                    (FB+NFB+Inv)</th>
                <th>Assett Classification
                    (Including SMA status)</th>
                <th>Provision Made</th>
            </tr>
            <tr *ngFor = "let account of accounts">
                <td>{{account.serialNumber}}</td>
                <td>{{account.borrowerName}}</td>
                <td>{{account.segment}}</td>
                <td>{{account.exposure}}</td>
                <td>{{account.outstanding}}</td>
                <td>{{account.assetClassification}}</td>
                <td>{{account.provision}}</td>

            </tr>    
    </table> -->


        <p-table [value]="accounts" [ngClass]="{'submited-report':(reportStatus==='SUBMITTED' || isChecker)}" styleClass="stressv p-datatable-gridlines"  dataKey="id" *ngIf="accounts">
            <ng-template pTemplate="header">
                <tr>
                    <!-- type1 -->
                    <th *ngIf="tableType1">S.no</th>
                    <th *ngIf="tableType1">Borrower Name</th>
                    <th *ngIf="tableType1">Segment
                        (Infra, NBFC, SME, Retail, Telcom, etc.)</th>
                    <th *ngIf="tableType1">Exposure</th>
                    <th *ngIf="tableType1">OutStanding
                        (FB+NFB+Inv)</th>
                    <th *ngIf="tableType1">Assett Classification
                        (Including SMA status)</th>
                    <th *ngIf="tableType1">Provision Made</th>
                     <!-- type2 -->
                    <th *ngIf="tableType2">S.no</th>
                    <th *ngIf="tableType2">Borrower Name</th>
                    <th *ngIf="tableType2">Exposure</th>
                    <th *ngIf="tableType2">OutStanding </th>

                      <!-- type3  -->
                      <th *ngIf="tableType3">S.no</th>
                      <th *ngIf="tableType3">Borrower Name</th>
                      <th *ngIf="tableType3">Exposure</th>
                      <th *ngIf="tableType3">OutStanding </th>
                    <th *ngIf="tableType3"> Provision Made </th>
                    <th *ngIf="tableType3">Additional provision for non-implementation of RP
                    </th>
                    <!-- type4  -->
                    <th *ngIf="tableType4">S.no</th>
                    <th *ngIf="tableType4">Borrower Name</th>
                    <th *ngIf="tableType4">Current Status
                        (SMA 0,SMA 1, SMA 2, SubStandard, D1, D2)</th>
                    <th *ngIf="tableType4">OutStanding
                        (FB+NFB+Inv)</th>
                    <th *ngIf="tableType4">Provision Made </th>
                    <th *ngIf="tableType4">Recovery Expected
                        (Amount)</th>
                    <th *ngIf="tableType4">Remarks (along with
                        month/year by when recovery is expected)</th> 
                </tr>

            </ng-template>
            <ng-template pTemplate="body" let-account>
                <tr>
                    <td *ngIf="tableType1">
                        <p-cellEditor>
                            <ng-template pTemplate="input">
                                <input pInputText type="text" [(ngModel)]="account.serialNumber">
                            </ng-template>
                            <ng-template pTemplate="output">
                                {{account.serialNumber}}
                            </ng-template>
                        </p-cellEditor>
                    </td>
                    <td style="text-align: left;" *ngIf="tableType1  && !reportStatusFlag">
                        {{account.borrowerName}}
                    </td>
                    <td pEditableColumn *ngIf="(tableType1) && reportStatusFlag">
                        <p-cellEditor>
                            <ng-template pTemplate="input">
                                <input  pInputText type="text" [(ngModel)]="account.borrowerName" required>
                            </ng-template>
                            <ng-template pTemplate="output">
                                {{account.borrowerName}}
                            </ng-template>
                        </p-cellEditor>
                    </td> 
                    
                    <td  style="text-align: left;" *ngIf="(tableType1 ) && !reportStatusFlag">
                         {{account.segment}}
                    </td>
                    <td min="0" pEditableColumn *ngIf="(tableType1 ) && reportStatusFlag">
                        <p-cellEditor>
                            <ng-template pTemplate="input">
                                <input pInputText type="text" [(ngModel)]="account.segment" required>
                            </ng-template>
                            <ng-template pTemplate="output">
                                {{account.segment}}
                            </ng-template>
                        </p-cellEditor>
                    </td>
                    <td style="text-align: left;" *ngIf="(tableType1 ) && !reportStatusFlag">
                        {{account.exposure}}
                    </td>
                    <td min="0" pEditableColumn *ngIf="(tableType1 ) && reportStatusFlag">
                        <p-cellEditor>
                            <ng-template pTemplate="input">
                                <input pInputText type="text" [(ngModel)]="account.exposure" required>
                            </ng-template>
                            <ng-template pTemplate="output">
                                {{account.exposure}}
                            </ng-template>
                        </p-cellEditor>
                    </td>
                    <td style="text-align: left;" *ngIf="(tableType1) && !reportStatusFlag">
                        {{account.outstanding}}
                    </td>
                    <td pEditableColumn *ngIf="(tableType1 ) && reportStatusFlag">
                        <p-cellEditor>
                            <ng-template pTemplate="input">
                                <input pInputText type="text" (onInput)="onInput($event)"
                                    [(ngModel)]="account.outstanding" required>
                            </ng-template>
                            <ng-template pTemplate="output">
                                {{account.outstanding}}
                            </ng-template>
                        </p-cellEditor>
                    </td>
                    <td style="text-align: left;" *ngIf="(tableType1 ) && !reportStatusFlag">
                        {{account.assetClassification}}
                    </td>
                    <td pEditableColumn *ngIf="(tableType1 ) && reportStatusFlag">
                        <p-cellEditor>
                            <ng-template pTemplate="input">
                                <input pInputText type="text" [(ngModel)]="account.assetClassification" required>
                            </ng-template>
                            <ng-template pTemplate="output">
                                {{account.assetClassification}}
                            </ng-template>
                        </p-cellEditor>
                    </td>
                    <td style="text-align: left;" *ngIf="(tableType1 ) && !reportStatusFlag">
                        {{account.provision}}
                    </td>
                    <td pEditableColumn *ngIf="(tableType1 ) && reportStatusFlag">
                        <p-cellEditor>
                            <ng-template pTemplate="input">
                                <input pInputText type="text" [(ngModel)]="account.provision" required>
                            </ng-template>
                            <ng-template pTemplate="output">
                                {{account.provision}}
                            </ng-template>
                        </p-cellEditor>
                    </td>
                    <!-- table type2 -->
                    <td *ngIf="tableType2">
                        <p-cellEditor>
                            <ng-template pTemplate="input">
                                <input pInputText type="text" [(ngModel)]="account.serialNumber">
                            </ng-template>
                            <ng-template pTemplate="output">
                                {{account.serialNumber}}
                            </ng-template>
                        </p-cellEditor>
                    </td>
                    <td style="text-align: left;" *ngIf="tableType2  && !reportStatusFlag">
                        {{account.borrowerName}}
                    </td>
                    <td pEditableColumn *ngIf="(tableType2) && reportStatusFlag">
                        <p-cellEditor>
                            <ng-template pTemplate="input">
                                <input  pInputText type="text" [(ngModel)]="account.borrowerName" required>
                            </ng-template>
                            <ng-template pTemplate="output">
                                {{account.borrowerName}}
                            </ng-template>
                        </p-cellEditor>
                    </td>
                    <td style="text-align: left;" *ngIf="(tableType2 ) && !reportStatusFlag">
                        {{account.exposure}}
                    </td>
                    <td min="0" pEditableColumn *ngIf="(tableType2 ) && reportStatusFlag">
                        <p-cellEditor>
                            <ng-template pTemplate="input">
                                <input pInputText type="text" [(ngModel)]="account.exposure" required>
                            </ng-template>
                            <ng-template pTemplate="output">
                                {{account.exposure}}
                            </ng-template>
                        </p-cellEditor>
                    </td>
                    <td style="text-align: left;" *ngIf="(tableType2) && !reportStatusFlag">
                        {{account.outstanding}}
                    </td>
                    <td pEditableColumn *ngIf="(tableType2 ) && reportStatusFlag">
                        <p-cellEditor>
                            <ng-template pTemplate="input">
                                <input pInputText type="text" (onInput)="onInput($event)"
                                    [(ngModel)]="account.outstanding" required>
                            </ng-template>
                            <ng-template pTemplate="output">
                                {{account.outstanding}}
                            </ng-template>
                        </p-cellEditor>
                    </td>

        <!-- type3 -->
                    <td *ngIf="tableType3">
                        <p-cellEditor>
                            <ng-template pTemplate="input">
                                <input pInputText type="text" [(ngModel)]="account.serialNumber">
                            </ng-template>
                            <ng-template pTemplate="output">
                                {{account.serialNumber}}
                            </ng-template>
                        </p-cellEditor>
                    </td>
                    <td style="text-align: left;" *ngIf="tableType3  && !reportStatusFlag">
                        {{account.borrowerName}}
                    </td>
                    <td pEditableColumn *ngIf="(tableType3) && reportStatusFlag">
                        <p-cellEditor>
                            <ng-template pTemplate="input">
                                <input  pInputText type="text" [(ngModel)]="account.borrowerName" required>
                            </ng-template>
                            <ng-template pTemplate="output">
                                {{account.borrowerName}}
                            </ng-template>
                        </p-cellEditor>
                    </td>
                    <td style="text-align: left;" *ngIf="(tableType3) && !reportStatusFlag">
                        {{account.exposure}}
                    </td>
                    <td min="0" pEditableColumn *ngIf="(tableType3) && reportStatusFlag">
                        <p-cellEditor>
                            <ng-template pTemplate="input">
                                <input pInputText type="text" [(ngModel)]="account.exposure" required>
                            </ng-template>
                            <ng-template pTemplate="output">
                                {{account.exposure}}
                            </ng-template>
                        </p-cellEditor>
                    </td>
                    <td style="text-align: left;" *ngIf="(tableType3) && !reportStatusFlag">
                        {{account.outstanding}}
                    </td>
                    <td pEditableColumn *ngIf="(tableType3 ) && reportStatusFlag">
                        <p-cellEditor>
                            <ng-template pTemplate="input">
                                <input pInputText type="text" (onInput)="onInput($event)"
                                    [(ngModel)]="account.outstanding" required>
                            </ng-template>
                            <ng-template pTemplate="output">
                                {{account.outstanding}}
                            </ng-template>
                        </p-cellEditor>
                    </td>
                    <td style="text-align: left;" *ngIf="(tableType3 ) && !reportStatusFlag">
                        {{account.provision}}
                    </td>
                    <td pEditableColumn *ngIf="(tableType3 ) && reportStatusFlag">
                        <p-cellEditor>
                            <ng-template pTemplate="input">
                                <input pInputText type="text" [(ngModel)]="account.provision" required>
                            </ng-template>
                            <ng-template pTemplate="output">
                                {{account.provision}}
                            </ng-template>
                        </p-cellEditor>
                    </td>
   <!-- type4 -->
                    <td *ngIf="tableType4">
                        <p-cellEditor>
                            <ng-template pTemplate="input">
                                <input pInputText type="text" [(ngModel)]="account.serialNumber">
                            </ng-template>
                            <ng-template pTemplate="output">
                                {{account.serialNumber}}
                            </ng-template>
                        </p-cellEditor>
                    </td>
                    <td style="text-align: left;" *ngIf="tableType4  && !reportStatusFlag">
                        {{account.borrowerName}}
                    </td>
                    <td pEditableColumn *ngIf="(tableType4) && reportStatusFlag">
                        <p-cellEditor>
                            <ng-template pTemplate="input">
                                <input  pInputText type="text" [(ngModel)]="account.borrowerName" required>
                            </ng-template>
                            <ng-template pTemplate="output">
                                {{account.borrowerName}}
                            </ng-template>
                        </p-cellEditor>
                    </td>
                    <td style="text-align: left;" *ngIf="(tableType4 ) && !reportStatusFlag">
                        {{account.exposure}}
                    </td>
                    <td min="0" pEditableColumn *ngIf="(tableType4 ) && reportStatusFlag">
                        <p-cellEditor>
                            <ng-template pTemplate="input">
                                <input pInputText type="text" [(ngModel)]="account.exposure" required>
                            </ng-template>
                            <ng-template pTemplate="output">
                                {{account.exposure}}
                            </ng-template>
                        </p-cellEditor>
                    </td>
                    <td style="text-align: left;" *ngIf="(tableType4) && !reportStatusFlag">
                        {{account.outstanding}}
                    </td>
                    <td pEditableColumn *ngIf="(tableType4 ) && reportStatusFlag">
                        <p-cellEditor>
                            <ng-template pTemplate="input">
                                <input pInputText type="text" (onInput)="onInput($event)"
                                    [(ngModel)]="account.outstanding" required>
                            </ng-template>
                            <ng-template pTemplate="output">
                                {{account.outstanding}}
                            </ng-template>
                        </p-cellEditor>
                    </td>
                    <td style="text-align: left;" *ngIf="(tableType4 ) && !reportStatusFlag">
                        {{account.assetClassification}}
                    </td>
                    <td pEditableColumn *ngIf="(tableType4 ) && reportStatusFlag">
                        <p-cellEditor>
                            <ng-template pTemplate="input">
                                <input pInputText type="text" [(ngModel)]="account.assetClassification" required>
                            </ng-template>
                            <ng-template pTemplate="output">
                                {{account.assetClassification}}
                            </ng-template>
                        </p-cellEditor>
                    </td>
                    <td style="text-align: left;" *ngIf="(tableType4 ) && !reportStatusFlag">
                        {{account.provision}}
                    </td>
                    <td pEditableColumn *ngIf="(tableType4 ) && reportStatusFlag">
                        <p-cellEditor>
                            <ng-template pTemplate="input">
                                <input pInputText type="text" [(ngModel)]="account.provision" required>
                            </ng-template>
                            <ng-template pTemplate="output">
                                {{account.provision}}
                            </ng-template>
                        </p-cellEditor>
                    </td>

                </tr>
            </ng-template>
        </p-table>
        <div>
            <textarea [disabled]="!isChecker || reportStatus!='SUBMITTED'" [(ngModel)]="comments" class="comment" placeholder="Comment here..."></textarea>
        </div>

        <div *ngIf="isMaker" class="text-center mt-2 mb-2 pt-2">
            <button [disabled]="reportStatus=='SUBMITTED' || reportStatus=='APPROVED'" pButton icon="pi pi-check" label="Save" class="p-button-primary mr-2" (click)="save()"></button>
            <button [disabled]="reportStatus=='SUBMITTED' || reportStatus=='APPROVED'" pButton type="button" icon="pi pi-upload" label="Submit" class=" ml-2 p-button-success"
                (click)="confirm('SUBMITTED')"></button>
        </div>

        <div *ngIf="isChecker" class="text-center mt-2 mb-2 pt-2">
            <button pButton icon="pi-pi-times" [disabled]="reportStatus!='SUBMITTED'" (click)="confirm('REJECTED')" label="Reject"
                class="p-button-primary mr-2"></button>
            <button pButton type="button" [disabled]="reportStatus!='SUBMITTED'" (click)="confirm('APPROVED')" label="Approve"
                class=" ml-2 p-button-success"></button>
        </div>

    </div>
    <div>
        

    </div>
</div>
<p-confirmDialog header="Confirmation" icon="pi pi-exclamation-triangle"></p-confirmDialog>