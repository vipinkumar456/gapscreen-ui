<p-toast position="top-right">
</p-toast>

<div class="p-grid"></div>
<div class="p-col">
    <h3 style="text-align: center;padding-top: 12px;"  class="m-0 pt-1" >{{heading}}</h3>
</div>
<div class="card">
    <p-tabView>
    <div class="p-col text-right"  *ngIf="isMaker" >
        <button pButton type="button" icon="pi pi-plus" iconPos="right" class="mr-2 " label="Add" (click)="add()"></button>
        <p-button label="Rejected Records" iconPos="left" styleClass="p-button p-button-pnb btn-block"
        (click)="rejectedRecords()"></p-button>
    </div>
    <div class="p-col text-right"  >
        <span class="text-right" style="font-weight: 600;position: relative;
        top: -7px;">( Rs. In Lacks )</span>
    </div>
    <div>
    </div>
    
    <div class="scroller">
        
    <p-table [value]="display"  dataKey="name" editMode="row" class="tableFixed" styleClass="p-datatable-gridlines top-20">
        <ng-template pTemplate="header">
            <tr>
                <th *ngIf="isChecker || rejectedFlag"></th>
                <ng-container *ngFor="let name of tableheadingNames">
                
                <th  colspan="1" *ngIf="name.name=='PERIOD'" > 
                    <ng-container >
                        {{name.name}}
                    </ng-container>
                 </th> 
                 <th  colspan="1" *ngIf="name.title=='createdBy'" > 
                    <ng-container >
                        {{name.name}}
                    </ng-container>
                 </th> 
                 <th  colspan="1" *ngIf="name.title=='createdOn'" > 
                    <ng-container >
                        {{name.name}}
                    </ng-container>
                 </th> 
                 <th colspan="2" *ngIf="name.name!=='PERIOD' && name.title!=='createdBy' && name.title!=='createdOn'">  
                    <ng-container   >
                        {{name.name}}
                    </ng-container>
                 </th>
                </ng-container>
                <th colspan="3"></th>                
            </tr>
            <tr>
                <th style="min-width:50px;" *ngIf="isChecker || rejectedFlag">
                    <input type="checkbox" name="checkedAll" [(ngModel)]="checkedAll"
                        (change)="checkAll()">
                </th>
                <ng-container *ngFor="let heading of tableNames">
                <th *ngIf="heading.name=='FROM'">
                        
                </th>
                <th *ngIf="heading.name!=='FROM'">
                    {{heading.name}}
                </th>
                </ng-container>
                <th *ngIf="!isChecker && !rejectedFlag">Action</th>
            </tr>
        </ng-template>
       
        <ng-template pTemplate="body" let-account let-ri="rowIndex">

            <tr [pEditableRow]="account">
                <ng-container>
                    <td *ngIf="isChecker || rejectedFlag"><input type="checkbox" name="checked{{ri}}"
                            [(ngModel)]="account.checked" (change)="checkRecord(account)"></td>
                    <td pEditableColumn *ngFor="let name of tableNames" style="min-width: 200px"
                        [ngClass]="{'disabled':(!name.editable || submitted || isChecker)}" [ngStyle]="{'background-color': !name.editable || isChecker ? '#dee2e6' :'#fff' }">
                        <ng-container *ngIf="!name.editable || submitted || isChecker">
                            {{name.title=="createdOn" || name.title=="date"?(account[name.title] |
                                date : 'dd-MM-yyyy'):name.title=="PERIODFrom"?(account[name.title] |
                                dateRangeShort):name.title=="ourDebitsAmount" || name.title=="theirDebitsAmount" || name.title=="totalDebits1Amt" || name.title=="ourCreditsAmount" || name.title=="theirCreditsAmount" || name.title=="totalCreditsAmt"?
                                (account[name.title] | number:'1.2-2' | removeComma):account[name.title]}}
                        </ng-container>
                        <ng-container>
                            {{name.edit}}
                        </ng-container>
                        <p-cellEditor *ngIf="(name.editable && !submitted) && !isChecker">
                            <ng-template pTemplate="input">
                                <p-calendar [(ngModel)]="account[name.title]" *ngIf="name.title=='PERIODFrom'" [name]="name.title"  view="month"  dateFormat="mm/yy" selectionMode="range" [readonlyInput]="true" [showIcon]="true" inputId="range"  ></p-calendar>
                                <input pInputText (keypress)="numberOnly($event)" [required]="name.required" *ngIf="name.title=='ourDebitsNo' || name.title=='theirDebitsNo' || name.title=='ourCreditsNo' || name.title=='theirCreditsNo'"
                                    [(ngModel)]="account[name.title]"  [name]="name.title" [type]="name.inpType"
                                    (change)="totaladdition(account,name)" [min]="1" style="width:100%"> 
                                <input pInputText (keypress)="numberOnlyWithDismal($event)" [required]="name.required" *ngIf="name.title=='ourDebitsAmount' || name.title=='theirDebitsAmount' || name.title=='ourCreditsAmount' || name.title=='theirCreditsAmount'"
                                    [(ngModel)]="account[name.title]"  [name]="name.title" [type]="name.inpType"
                                    (change)="totaladdition(account,name)" [min]="1" style="width:100%">
                                <!-- <input pInputText (keypress)="numberOnly($event)" [required]="name.required" *ngIf="name.title!=='PERIODFrom' && name.title!=='totalDebits1No' && name.title!=='totalDebits1Amt' && name.title!=='totalCreditsNo' && name.title!=='totalCreditsAmt'"
                                    [(ngModel)]="account[name.title]"  [name]="name.title" [type]="name.inpType"
                                    (change)="totaladdition(account,name)" [min]="1" style="width:100%">     -->
                            </ng-template>
                            <ng-template pTemplate="output">
                                {{name.title=="createdOn" || name.title=="date"?(account[name.title] |
                                date : 'dd-MM-yyyy'):name.title=="PERIODFrom"?(account[name.title] |
                                dateRangeShort):name.title=="ourDebitsAmount" || name.title=="theirDebitsAmount" || name.title=="totalDebits1Amt" || name.title=="ourCreditsAmount" || name.title=="theirCreditsAmount" || name.title=="totalCreditsAmt"?
                                (account[name.title] | number:'1.2-2' | removeComma):account[name.title]}}
                            </ng-template>
                        </p-cellEditor>
                    </td>
                    <td *ngIf="!isChecker && !rejectedFlag">
                        <i class="pi pi-trash text-danger" (click)="delete(ri)"></i>
                    </td>

                </ng-container>
                </tr>

        </ng-template>

        <ng-template pTemplate="footer" *ngIf="isMaker && !rejectedFlag" >
            <tr style="background-color: gray;">
                <ng-container *ngIf="!isChecker && !rejectedFlag">
                    <td><b>TOTAL</b></td>
                    <td>{{total?.ourDebitsNo}}</td>
                    <td>{{total?.ourDebitsAmount | number:'1.2-2' | removeComma}}</td>
                    <td>{{total?.theirDebitsNo}}</td>
                    <td>{{total?.theirDebitsAmount | number:'1.2-2' | removeComma}}</td>
                    <td>{{total?.totalDebits1No}}</td>
                    <td>{{total?.totalDebits1Amt | number:'1.2-2' | removeComma}}</td>
                    <td>{{total?.ourCreditsNo}}</td>
                    <td>{{total?.ourCreditsAmount | number:'1.2-2' | removeComma}}</td>
                    <td>{{total?.theirCreditsNo}}</td>
                    <td>{{total?.theirCreditsAmount | number:'1.2-2' | removeComma}}</td>
                    <td>{{total?.totalCreditsNo}}</td>
                    <td>{{total?.totalCreditsAmt | number:'1.2-2' | removeComma}}</td>
                    <td colspan="3"></td>
                </ng-container> 
            </tr>
            <!-- <tr style="background-color: gray;">
                <td></td>
                <td><b>Total</b></td>
                <td>{{total?.ourDebitsNo}}</td>
                <td>{{total?.ourDebitsAmount}}</td>
                <td>{{total?.theirDebitsNo}}</td>
                <td>{{total?.theirDebitsAmount}}</td>
                <td>{{total?.totalDebits1No}}</td>
                <td>{{total?.totalDebits1Amt}}</td>
                <td>{{total?.ourCreditsNo}}</td>
                <td>{{total?.ourCreditsAmount}}</td>
                <td>{{total?.theirCreditsNo}}</td>
                <td>{{total?.theirCreditsAmount}}</td>
                <td>{{total?.totalCreditsNo}}</td>
                <td>{{total?.totalCreditsAmt}}</td>
                <td></td>
                <td></td>
                <td *ngIf="isMaker"></td>
                </tr> -->
        </ng-template>
    </p-table>
</div>
</p-tabView>
</div>
<div *ngIf="isChecker">
    <textarea [disabled]="submitted==true" class="comments" [(ngModel)]="comments"
        placeholder="Comment Here..."></textarea>
</div>

<div *ngIf="isMaker" style="margin-top: 1%;text-align: center;">

    <button pButton icon="pi"  label="Submit"  type="submit" (click)="submit('submit')" [disabled]="submitted==true" style="border: none;background: #a20a3a;color: white;" class="p-button-primary mr-2"></button>
</div>

<div *ngIf="isChecker" class="text-center mt-2 mb-2 pt-2">
    <button [disabled]="submitted==true" pButton icon="pi-pi-times" (click)="confirm('REJECTED')" label="Reject"
        class="p-button-primary mr-2"></button>
    <button [disabled]="submitted==true" pButton type="button" (click)="confirm('APPROVED')" label="Approve"
        class=" ml-2 p-button-success"></button>
</div>


<p-confirmDialog header="Confirmation" icon="pi pi-exclamation-triangle"></p-confirmDialog>